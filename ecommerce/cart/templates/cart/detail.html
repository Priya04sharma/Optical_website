{% extends 'shop/base.html' %}
{% load static %}

{% block title %}
    Your Shopping Cart
{% endblock %}

{% block content %}
<div class="container" style="margin-top: 6%">
    <div class="row">
        <h2 style="color: white; background: linear-gradient(to right, #30CFD0, #330867); padding: 15px; border-radius: 8px;">
            üõí Your Shopping Cart
            <span class="badge pull-right" style="background-color: #ffffff; color: #330867;">
                {% with total_items=cart|length %}
                    {% if total_items > 0 %}
                        {{ total_items }} item{{ total_items|pluralize }}, Rs. {{ cart.get_total_price }}
                    {% else %}
                        No items added.
                    {% endif %}
                {% endwith %}
            </span>
        </h2>

        {% if cart|length > 0 %}
        <table class="table mt-4">
            <thead style="background: linear-gradient(to right, #30CFD0, #330867); color: white;">
                <tr>
                    <th>Image</th>
                    <th>Product</th>
                    <th>Quantity</th>
                    <th>Remove</th>
                    <th>Unit Price</th>
                    <th>Total</th>
                </tr>
            </thead>
            <tbody>
                {% for item in cart %}
                    {% with product=item.product %}
                    <tr>
                        <td>
                            <a href="{{ product.get_absolute_url }}">
                                <img src="{% if product.image %}{{ product.image.url }}{% else %}{% static 'img/default.jpg' %}{% endif %}" alt="{{ product.name }}" style="height: 130px; width: auto;">
                            </a>
                        </td>
                        <td>{{ product.name }}</td>
                        <td>
                            <form action="{% url 'cart_add' product.id %}" method="post">
                                {% csrf_token %}
                                <div style="display: flex; align-items: center; gap: 6px;">
                                    <input type="number" name="quantity" value="{{ item.quantity }}" min="1" max="{{ product.stock }}"
                                           class="form-control form-control-sm" 
                                           style="width: 60px; height: 35px; padding: 5px; font-size: 1rem;">
                            
                                    <button type="submit"
                                            class="btn btn-sm"
                                            style="background-color: #30CFD0; color: white; height: 35px; width: 35px; padding: 0; font-size: 1.1rem; line-height: 1;">
                                        +
                                    </button>
                                </div>
                            </form>
                            
                            
                        </td>
                        <td>
                            <a href="{% url 'cart_remove' product.id %}" class="btn btn-danger btn-sm">Remove</a>
                        </td>
                        <td>Rs. {{ item.price }}</td>
                        <td>Rs. {{ item.total_price }}</td>
                    </tr>
                    {% endwith %}
                {% endfor %}
                <tr style="background: linear-gradient(to right, #30CFD0, #330867); color: white;">
                    <td><b>Total</b></td>
                    <td colspan="4"></td>
                    <td><b>Rs. {{ cart.get_total_price }}</b></td>
                </tr>
            </tbody>
        </table>

        <p class="text-right mt-4">
            <a href="{% url 'shop:product_list' %}" class="btn btn-outline-secondary">üõçÔ∏è Continue Shopping</a>
            <a href="{% url 'orders:create' %}" class="btn btn-primary" style="background: linear-gradient(to right, #30CFD0, #330867); border: none;">Checkout</a>
        </p>

        {% else %}
        <div class="text-center mt-5">
            <h3>üõí No items added to cart</h3>
            <p style="font-size: 1.2rem;">Looks like you haven't added anything yet.</p>
            <a href="{% url 'shop:product_list' %}" class="btn btn-primary mt-3" style="background: linear-gradient(to right, #30CFD0, #330867); border: none;">
                üõçÔ∏è Start Shopping
            </a>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
